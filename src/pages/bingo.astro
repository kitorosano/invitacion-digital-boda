---
import { getCollection } from "astro:content";
import Board from "../components/bingo/Board";
import Instructions from "../components/bingo/Instructions.astro";
import RegisterUser from "../components/bingo/RegisterUser.astro";
import {
  instructionsProps,
  layoutProps,
  registerUserProps,
} from "../constants/bingo";
import BingoLayout from "../layouts/BingoLayout.astro";

const isLogged = Astro.cookies.has("userId");

const optionalTasks = await getCollection("optionalTasks");
const mandatoryTasks = await getCollection("mandatoryTasks");
const boardProps = {
  optionalTasks: optionalTasks.map((task) => task.data),
  mandatoryTasks: mandatoryTasks.map((task) => task.data),
};
---

<BingoLayout {...layoutProps}>
  <Instructions {...instructionsProps} isLogged={isLogged} />
  {
    !isLogged ? (
      <RegisterUser {...registerUserProps} />
    ) : (
      <Board {...boardProps} client:load />
    )
  }
</BingoLayout>
